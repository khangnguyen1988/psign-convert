<template>
  <app-modal name="user-profile-modal" :title="title" @before-open="beforeOpen" @before-close="beforeClose"  @on-ok="onOk">
    <app-form
      ref="formUser"
      @on-submit="onSubmitUserForm"
      :schema="schemaUser"
      :layout="layoutUser"
      :data="formModelUser"
    />
    <h4 class="section-header">{{$t('user.companyInformation')}}</h4>
    <app-form
      ref="formCompany"
      @on-submit="onSubmitCompanyForm"
      :schema="schemaCompany"
      :layout="layoutCompany"
      :data="formModelCompany"
    />
    <h4 class="section-header">{{$t('user.signature')}}</h4>
    <div class="row">
      <div class="col-md-6 text-center">
        <div class="d-flex justify-content-between pb-2">
          <span>{{$t('user.signatureImage')}}</span>
          <a v-if="!imageSignatureModel" @click="openModal('signature-modal')"  href="javascript:" >{{$t('user.management')}}</a>
          <a v-if="imageSignatureModel" @click="deleteImageSignature(imageSignatureModel)"  href="javascript:" >{{$t('user.delete')}}</a>
        </div>
        <div class="signature-place-holder text-center">
          <img width="60%" v-if="imageSignatureUrl" :src="imageSignatureUrl"  alt="Signature Image"/>
          <svg v-if="!imageSignatureUrl" viewBox="0 0 210 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="210" height="100" rx="4" fill="#E6ECF4"/>
            <g clip-path="url(#clip0_304_2644)">
              <g opacity="0.81">
                <path d="M82.4479 50.3932H79.1992C79.141 50.3932 79.0852 50.3704 79.044 50.3296C79.0029 50.2889 78.9797 50.2337 78.9797 50.1761C78.9797 50.1185 79.0029 50.0633 79.044 50.0226C79.0852 49.9819 79.141 49.959 79.1992 49.959H82.4479C82.5061 49.959 82.5619 49.9819 82.6031 50.0226C82.6442 50.0633 82.6674 50.1185 82.6674 50.1761C82.6674 50.2337 82.6442 50.2889 82.6031 50.3296C82.5619 50.3704 82.5061 50.3932 82.4479 50.3932Z" fill="white"/>
              </g>
              <path d="M102.186 42.7768C108.773 42.7768 114.113 37.4944 114.113 30.9782C114.113 24.4621 108.773 19.1797 102.186 19.1797C95.598 19.1797 90.2578 24.4621 90.2578 30.9782C90.2578 37.4944 95.598 42.7768 102.186 42.7768Z" fill="#599AF2"/>
              <path d="M116.291 27.2217H88.0824C83.3981 27.2217 79.6008 30.9779 79.6008 35.6114C79.6008 40.2449 83.3981 44.0011 88.0824 44.0011H116.291C120.975 44.0011 124.772 40.2449 124.772 35.6114C124.772 30.9779 120.975 27.2217 116.291 27.2217Z" fill="#599AF2"/>
              <path d="M106.906 39.3397C112.956 36.7612 115.747 29.8197 113.141 23.8354C110.534 17.8511 103.516 15.0902 97.4666 17.6686C91.4168 20.2471 88.6256 27.1886 91.2323 33.1729C93.839 39.1572 100.857 41.9182 106.906 39.3397Z" fill="#599AF2"/>
              <path d="M116.291 29.6948H88.0824C83.3981 29.6948 79.6008 33.451 79.6008 38.0845C79.6008 42.718 83.3981 46.4742 88.0824 46.4742H116.291C120.975 46.4742 124.772 42.718 124.772 38.0845C124.772 33.451 120.975 29.6948 116.291 29.6948Z" fill="#94B9ED"/>
              <path d="M116.291 27.2217H88.0824C83.3981 27.2217 79.6008 30.9779 79.6008 35.6114C79.6008 40.2449 83.3981 44.0011 88.0824 44.0011H116.291C120.975 44.0011 124.772 40.2449 124.772 35.6114C124.772 30.9779 120.975 27.2217 116.291 27.2217Z" fill="#3361A3"/>
              <path d="M106.906 39.3397C112.956 36.7612 115.747 29.8197 113.141 23.8354C110.534 17.8511 103.516 15.0902 97.4666 17.6686C91.4168 20.2471 88.6256 27.1886 91.2323 33.1729C93.839 39.1572 100.857 41.9182 106.906 39.3397Z" fill="#3361A3"/>
              <path d="M99.3933 30.2616C99.2845 30.2614 99.1783 30.2292 99.0881 30.1691C98.9978 30.109 98.9277 30.0238 98.8865 29.9242C98.8454 29.8247 98.835 29.7152 98.8569 29.6098C98.8787 29.5045 98.9317 29.4079 99.0091 29.3323L102.209 26.2188L105.359 29.3345C105.412 29.3845 105.454 29.4443 105.483 29.5105C105.511 29.5767 105.527 29.6479 105.527 29.72C105.528 29.792 105.514 29.8635 105.487 29.9303C105.459 29.997 105.419 30.0577 105.367 30.1087C105.316 30.1598 105.255 30.2001 105.187 30.2275C105.12 30.2549 105.048 30.2688 104.975 30.2682C104.902 30.2677 104.83 30.2528 104.763 30.2245C104.696 30.1961 104.635 30.1549 104.584 30.1031L102.203 27.7473L99.7884 30.1053C99.7365 30.1562 99.6748 30.1964 99.6069 30.2232C99.539 30.2501 99.4664 30.2631 99.3933 30.2616Z" fill="white"/>
              <path d="M102.188 34.5783C102.042 34.5783 101.903 34.5211 101.8 34.4193C101.697 34.3175 101.639 34.1794 101.639 34.0354V26.9832C101.639 26.8393 101.697 26.7012 101.8 26.5994C101.903 26.4976 102.042 26.4404 102.188 26.4404C102.333 26.4404 102.473 26.4976 102.576 26.5994C102.679 26.7012 102.736 26.8393 102.736 26.9832V34.0354C102.736 34.1794 102.679 34.3175 102.576 34.4193C102.473 34.5211 102.333 34.5783 102.188 34.5783Z" fill="white"/>
              <path d="M107.374 37.9284H96.9173C96.5568 37.9278 96.2112 37.7857 95.9564 37.5333C95.7017 37.2809 95.5586 36.9389 95.5586 36.5822V32.8216C95.5586 32.6777 95.6164 32.5396 95.7193 32.4378C95.8222 32.336 95.9618 32.2788 96.1073 32.2788C96.2529 32.2788 96.3925 32.336 96.4954 32.4378C96.5983 32.5396 96.6561 32.6777 96.6561 32.8216V36.5779C96.6561 36.6466 96.6835 36.7126 96.7325 36.7614C96.7814 36.8102 96.8478 36.8379 96.9173 36.8384H107.374C107.465 36.8379 107.552 36.8017 107.617 36.7378C107.681 36.674 107.717 36.5876 107.717 36.4975V32.8216C107.717 32.6777 107.775 32.5396 107.878 32.4378C107.98 32.336 108.12 32.2788 108.266 32.2788C108.411 32.2788 108.551 32.336 108.654 32.4378C108.756 32.5396 108.814 32.6777 108.814 32.8216V36.5127C108.811 36.8888 108.658 37.2485 108.389 37.5137C108.119 37.7788 107.755 37.9278 107.374 37.9284Z" fill="white"/>
              <path opacity="0.36" d="M118.78 73.8427L88.8575 83.6285C88.5082 83.7428 88.1273 83.7155 87.7983 83.5528C87.4692 83.39 87.2187 83.105 87.1015 82.76L77.2239 53.1616C77.1084 52.8161 77.1359 52.4393 77.3005 52.1138C77.465 51.7883 77.7532 51.5405 78.1019 51.4246L108.024 41.654C108.374 41.5403 108.754 41.5678 109.083 41.7305C109.412 41.8932 109.663 42.1779 109.78 42.5225L119.658 72.1209C119.769 72.4645 119.739 72.8373 119.575 73.1593C119.41 73.4813 119.125 73.7267 118.78 73.8427Z" fill="#4C65BA"/>
              <path opacity="0.36" d="M127.461 79.8595L104.094 79.3878C103.821 79.3823 103.561 79.2699 103.37 79.0752C103.179 78.8804 103.073 78.6192 103.075 78.3486L103.377 55.1773C103.381 54.9068 103.492 54.6494 103.687 54.4615C103.882 54.2736 104.144 54.1705 104.417 54.1747L127.781 54.6571C128.053 54.663 128.314 54.7755 128.504 54.9702C128.695 55.1648 128.801 55.4258 128.8 55.6962L128.497 78.8675C128.491 79.1356 128.379 79.3896 128.186 79.5751C127.992 79.7606 127.732 79.8628 127.461 79.8595Z" fill="#4C65BA"/>
              <path d="M105.817 40.5344L75.8937 50.312C75.1616 50.5512 74.7642 51.3322 75.006 52.0563L84.8907 81.6558C85.1325 82.38 85.922 82.7731 86.6541 82.5339L116.578 72.7563C117.31 72.517 117.707 71.7361 117.465 71.0119L107.581 41.4124C107.339 40.6883 106.549 40.2951 105.817 40.5344Z" fill="white"/>
              <path d="M105.266 43.7569L78.2395 52.5879L87.1672 79.3216L114.194 70.4906L105.266 43.7569Z" fill="#C5D9FF"/>
              <path opacity="0.47" d="M86.941 79.5425L84.9194 73.4912L87.8761 66.4412C88.0709 65.9697 88.4384 65.5882 88.9051 65.3728C89.3718 65.1575 89.9034 65.1242 90.3938 65.2796L95.866 66.9601C96.0229 67.0086 96.1918 67.0035 96.3455 66.9456C96.4991 66.8877 96.6287 66.7804 96.7132 66.641L101.27 59.1393C101.742 58.3712 102.477 57.7964 103.341 57.5198C104.205 57.2431 105.141 57.2831 105.978 57.6325L110.996 59.769L111.042 59.9079L114.583 70.5058L114.271 70.6078L86.941 79.5425ZM85.624 73.5173L87.3625 78.7283L113.762 70.1019L110.469 60.2597L105.726 58.2252C105.034 57.9329 104.258 57.8976 103.541 58.1257C102.825 58.3539 102.215 58.8302 101.825 59.4672L97.2686 66.971C97.1094 67.2369 96.8642 67.4419 96.5727 67.553C96.2811 67.6641 95.9602 67.6748 95.6618 67.5833L90.1897 65.9006C89.8567 65.797 89.4966 65.8211 89.1807 65.9678C88.8648 66.1146 88.6162 66.3735 88.4841 66.6931L85.624 73.5173Z" fill="white"/>
              <path opacity="0.47" d="M95.9648 58.6985C95.0817 58.6999 94.2304 58.3722 93.5806 57.7805C92.9308 57.1889 92.5302 56.3768 92.4586 55.506C92.387 54.6353 92.6497 53.7698 93.1944 53.0821C93.739 52.3944 94.5256 51.9349 95.3974 51.7952C96.2692 51.6555 97.1623 51.8458 97.8985 52.3283C98.6348 52.8107 99.1603 53.5499 99.3703 54.3984C99.5804 55.247 99.4594 56.1427 99.0317 56.907C98.604 57.6713 97.9008 58.2482 97.0624 58.5226C96.7085 58.6394 96.3379 58.6988 95.9648 58.6985ZM95.9648 52.4192C95.3611 52.4182 94.7726 52.6065 94.2839 52.9573C93.7953 53.308 93.4317 53.803 93.2454 54.3711C93.0592 54.9391 93.0599 55.551 93.2474 56.1187C93.4349 56.6863 93.7997 57.1805 94.2891 57.5301C94.7786 57.8798 95.3675 58.0669 95.9712 58.0645C96.575 58.062 97.1624 57.8703 97.649 57.5168C98.1355 57.1632 98.4962 56.6662 98.6792 56.097C98.8621 55.5279 98.8578 54.916 98.6669 54.3495C98.4761 53.7884 98.1125 53.3005 97.6271 52.9543C97.1417 52.6081 96.5589 52.421 95.9605 52.4192H95.9648Z" fill="white"/>
              <path d="M126.46 51.9912H103.101C102.33 51.9912 101.705 52.6095 101.705 53.3721V76.4785C101.705 77.2412 102.33 77.8594 103.101 77.8594H126.46C127.231 77.8594 127.856 77.2412 127.856 76.4785V53.3721C127.856 52.6095 127.231 51.9912 126.46 51.9912Z" fill="white"/>
              <path opacity="0.39" d="M125.615 54.1953H103.917V75.6581H125.615V54.1953Z" fill="#F7A9B4"/>
              <path opacity="0.47" d="M125.973 75.8445H103.619V70.8789L107.482 66.4539C107.749 66.1475 108.122 65.9509 108.529 65.9027C108.935 65.8545 109.344 65.9581 109.677 66.1934L113.231 68.7055C113.319 68.767 113.425 68.7977 113.532 68.7926C113.64 68.7875 113.742 68.7469 113.824 68.6773L118.936 64.3348C119.479 63.8751 120.171 63.6248 120.886 63.63C121.6 63.6351 122.289 63.8955 122.825 64.363L125.966 67.1183L125.973 75.8445ZM104.277 75.1932H125.314V67.4027L122.395 64.8407C121.978 64.4779 121.443 64.2759 120.888 64.272C120.333 64.268 119.795 64.4622 119.373 64.819L114.26 69.1723C114.067 69.3368 113.824 69.4324 113.569 69.4438C113.314 69.4552 113.063 69.3818 112.856 69.2353L109.3 66.7231C109.1 66.5814 108.854 66.5189 108.61 66.5478C108.366 66.5768 108.143 66.6951 107.983 66.8795L104.28 71.1199L104.277 75.1932Z" fill="white"/>
              <path opacity="0.47" d="M116.104 63.0213C115.561 63.0213 115.029 62.8618 114.577 62.5631C114.125 62.2644 113.773 61.8399 113.565 61.3432C113.357 60.8464 113.303 60.2999 113.409 59.7725C113.515 59.2452 113.777 58.7609 114.161 58.3807C114.545 58.0005 115.035 57.7416 115.568 57.6367C116.101 57.5318 116.654 57.5856 117.156 57.7914C117.658 57.9971 118.087 58.3456 118.389 58.7926C118.691 59.2396 118.852 59.7652 118.852 60.3029C118.852 61.0237 118.562 61.7148 118.047 62.2244C117.531 62.7341 116.833 63.0207 116.104 63.0213ZM116.104 58.2445C115.691 58.2445 115.287 58.3658 114.943 58.5929C114.6 58.82 114.332 59.1428 114.174 59.5205C114.015 59.8982 113.974 60.3139 114.055 60.7148C114.135 61.1158 114.334 61.4841 114.627 61.7732C114.919 62.0622 115.291 62.2591 115.696 62.3389C116.102 62.4186 116.522 62.3777 116.904 62.2212C117.286 62.0648 117.612 61.7999 117.842 61.4599C118.071 61.12 118.194 60.7204 118.194 60.3116C118.195 60.0395 118.141 59.7699 118.037 59.5182C117.932 59.2666 117.778 59.0378 117.584 58.845C117.39 58.6522 117.159 58.4991 116.905 58.3946C116.652 58.2901 116.379 58.2361 116.104 58.2358V58.2445Z" fill="white"/>
            </g>
            <defs>
              <clipPath id="clip0_304_2644">
                <rect width="62" height="74" fill="white" transform="translate(74 13)"/>
              </clipPath>
            </defs>
          </svg>
        </div>
      </div>
      <div class="col-md-6 text-center">
        <div class="d-flex justify-content-between pb-2">
          <span>{{$t('user.signatureDigital')}} </span>
          <a @click="openModal('digital-certificate-modal')"  href="javascript:" >{{$t('user.management')}}</a>
          <!-- <a v-if="digitalSignatureModel" @click="deleteDigitalSignature(digitalSignatureModel)"  href="javascript:" >Xoá</a> -->
        </div>
        <div class="signature-place-holder">
          <dl style="text-align: left; padding: 1rem .5rem" v-if="digitalSignatureModel">
            <dt>{{$t('user.signatureDigitalName')}}:</dt>
            <dd>{{digitalSignatureModel.owner_name}}</dd>
            <dt>{{$t('user.signatureDigitalSerial')}}:</dt>
            <dd style="font-size: 11px">{{digitalSignatureModel.seri_number}}</dd>
          </dl>
          <svg v-if="!digitalSignatureModel" viewBox="0 0 210 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="210" height="100" rx="4" fill="#E6ECF4"/>
            <path d="M115.255 29.6948H87.0472C82.363 29.6948 78.5657 33.451 78.5657 38.0845C78.5657 42.718 82.363 46.4742 87.0472 46.4742H115.255C119.94 46.4742 123.737 42.718 123.737 38.0845C123.737 33.451 119.94 29.6948 115.255 29.6948Z" fill="#94B9ED"/>
            <path d="M115.255 27.2217H87.0472C82.363 27.2217 78.5657 30.9779 78.5657 35.6114C78.5657 40.2449 82.363 44.0011 87.0472 44.0011H115.255C119.94 44.0011 123.737 40.2449 123.737 35.6114C123.737 30.9779 119.94 27.2217 115.255 27.2217Z" fill="#3361A3"/>
            <path d="M105.871 39.3397C111.921 36.7612 114.712 29.8197 112.105 23.8354C109.499 17.8511 102.481 15.0902 96.4314 17.6686C90.3816 20.2471 87.5905 27.1886 90.1972 33.1729C92.8039 39.1572 99.8214 41.9182 105.871 39.3397Z" fill="#3361A3"/>
            <path d="M98.3581 30.2616C98.2494 30.2614 98.1431 30.2292 98.0529 30.1691C97.9627 30.109 97.8925 30.0238 97.8514 29.9242C97.8102 29.8247 97.7999 29.7152 97.8217 29.6098C97.8435 29.5045 97.8965 29.4079 97.974 29.3323L101.174 26.2188L104.324 29.3345C104.377 29.3845 104.419 29.4443 104.447 29.5105C104.476 29.5767 104.491 29.6479 104.492 29.72C104.493 29.792 104.479 29.8635 104.452 29.9303C104.424 29.997 104.383 30.0577 104.332 30.1087C104.281 30.1598 104.219 30.2001 104.152 30.2275C104.085 30.2549 104.012 30.2688 103.939 30.2682C103.867 30.2677 103.795 30.2528 103.728 30.2245C103.661 30.1961 103.6 30.1549 103.549 30.1031L101.168 27.7473L98.7532 30.1053C98.7013 30.1562 98.6396 30.1964 98.5717 30.2232C98.5039 30.2501 98.4312 30.2631 98.3581 30.2616Z" fill="white"/>
            <path d="M101.153 34.5783C101.007 34.5783 100.867 34.5211 100.764 34.4193C100.662 34.3175 100.604 34.1794 100.604 34.0354V26.9832C100.604 26.8393 100.662 26.7012 100.764 26.5994C100.867 26.4976 101.007 26.4404 101.153 26.4404C101.298 26.4404 101.438 26.4976 101.541 26.5994C101.643 26.7012 101.701 26.8393 101.701 26.9832V34.0354C101.701 34.1794 101.643 34.3175 101.541 34.4193C101.438 34.5211 101.298 34.5783 101.153 34.5783Z" fill="white"/>
            <path d="M106.339 37.9284H95.8822C95.5216 37.9278 95.176 37.7857 94.9213 37.5333C94.6665 37.2809 94.5234 36.9389 94.5234 36.5822V32.8216C94.5234 32.6777 94.5813 32.5396 94.6842 32.4378C94.7871 32.336 94.9267 32.2788 95.0722 32.2788C95.2177 32.2788 95.3573 32.336 95.4602 32.4378C95.5631 32.5396 95.6209 32.6777 95.6209 32.8216V36.5779C95.6209 36.6466 95.6484 36.7126 95.6973 36.7614C95.7462 36.8102 95.8127 36.8379 95.8822 36.8384H106.339C106.43 36.8379 106.517 36.8017 106.581 36.7378C106.646 36.674 106.682 36.5876 106.682 36.4975V32.8216C106.682 32.6777 106.739 32.5396 106.842 32.4378C106.945 32.336 107.085 32.2788 107.23 32.2788C107.376 32.2788 107.515 32.336 107.618 32.4378C107.721 32.5396 107.779 32.6777 107.779 32.8216V36.5127C107.776 36.8888 107.623 37.2485 107.354 37.5137C107.084 37.7788 106.719 37.9278 106.339 37.9284Z" fill="white"/>
            <path d="M118.844 48.0549L117.669 47.7087C115.346 47.025 113.329 49.4481 114.422 51.6078C114.734 52.2246 114.804 52.9361 114.617 53.6019L109.504 71.811C109.311 72.4997 109.044 73.1658 108.709 73.7977L108.65 73.9079C106.379 78.1877 101.337 80.1862 96.7538 78.6232L83.6199 74.1442C82.568 73.7855 81.5109 74.6735 81.6825 75.7717C81.7716 76.3422 82.1816 76.8068 82.7365 76.9664C88.6119 78.6572 99.2328 82.0433 101.032 83.925C101.704 84.6283 102.623 84.9606 103.606 85.0639C106.786 85.3984 109.139 82.5353 110.309 79.5581L120.976 52.4149C121.683 50.6167 120.697 48.6003 118.844 48.0549Z" fill="#AEBBDF"/>
            <path d="M108.291 82.3174L122.658 70.0804L123.631 69.1697C124.452 68.4007 124.83 67.2693 124.635 66.1618C124.503 65.4126 124.118 64.7315 123.545 64.2318L117.922 59.3314C117.852 59.2705 117.773 59.2208 117.687 59.1841C117.238 58.991 116.717 59.1938 116.517 59.6396L106.81 81.2054C106.666 81.5239 106.709 81.8952 106.921 82.1723C107.252 82.6039 107.877 82.6701 108.291 82.3174Z" fill="#AEBBDF"/>
            <path d="M122.287 67.5113L119.727 69.9073L109.316 79.6522L106.044 82.7148C105.638 83.0945 105.083 83.3143 104.501 83.3258C103.919 83.3373 103.357 83.1397 102.94 82.7762L102.264 82.1885L90.9635 72.3473L77.7537 60.8442C77.3363 60.4805 77.0971 59.981 77.0888 59.4554C77.0805 58.9298 77.3037 58.4212 77.7093 58.0413L82.7205 53.3507L86.9533 49.389L93.9528 42.8378C94.3587 42.4582 94.9136 42.2385 95.4957 42.227C96.0778 42.2154 96.6393 42.413 97.057 42.7763L99.4776 44.8846L114.573 58.0297L122.242 64.7091C122.659 65.0725 122.898 65.5719 122.907 66.0973C122.915 66.6228 122.693 67.1314 122.287 67.5113Z" fill="#C5D9FF"/>
            <path d="M106.134 83.0945C105.648 83.4725 105.025 83.6741 104.386 83.6599C103.748 83.6456 103.14 83.4166 102.682 83.0176L77.4963 61.0857C77.0092 60.6606 76.7303 60.0771 76.7206 59.4633C76.7109 58.8494 76.9713 58.2552 77.4446 57.8112L93.688 42.608C93.9227 42.3883 94.2027 42.2121 94.512 42.0896C94.8213 41.9671 95.1538 41.9006 95.4905 41.8939C95.8273 41.8872 96.1617 41.9405 96.4746 42.0507C96.7876 42.1609 97.073 42.3259 97.3145 42.5362L122.501 64.4679C122.988 64.8929 123.266 65.4764 123.276 66.0903C123.286 66.7041 123.025 67.2983 122.552 67.7423L106.309 82.9456C106.253 82.9978 106.195 83.0474 106.134 83.0945ZM94.3422 42.9619C94.2993 42.9954 94.2578 43.0307 94.2181 43.0681L77.9743 58.2724C77.6372 58.5885 77.4518 59.0115 77.4587 59.4486C77.4656 59.8857 77.6642 60.3012 78.011 60.6038L103.197 82.5353C103.369 82.685 103.572 82.8025 103.795 82.881C104.018 82.9595 104.256 82.9975 104.496 82.9928C104.735 82.988 104.972 82.9407 105.192 82.8535C105.413 82.7663 105.612 82.6408 105.779 82.4844L122.022 67.2808L122.287 67.5114L122.022 67.2808C122.359 66.9646 122.545 66.5416 122.538 66.1045C122.531 65.6674 122.332 65.252 121.985 64.9493L96.7994 43.0178C96.4734 42.7339 96.0408 42.5708 95.5864 42.5605C95.132 42.5502 94.6883 42.6933 94.3422 42.9619Z" fill="white"/>
            <path d="M119.182 50.6074L108.118 80.716C108.027 80.9631 107.883 81.1919 107.695 81.3893C107.506 81.5867 107.276 81.7489 107.018 81.8666C106.76 81.9843 106.479 82.0552 106.191 82.0752C105.903 82.0952 105.614 82.064 105.34 81.9832L83.1871 75.4616C82.913 75.381 82.6594 75.2526 82.4409 75.0836C82.2224 74.9146 82.0432 74.7083 81.9136 74.4765C81.7839 74.2448 81.7064 73.9921 81.6854 73.7329C81.6644 73.4737 81.7003 73.2131 81.7911 72.966L92.8559 42.8574C92.9465 42.6102 93.0903 42.3813 93.279 42.1838C93.4677 41.9863 93.6976 41.824 93.9556 41.7062C94.2135 41.5884 94.4945 41.5175 94.7824 41.4974C95.0704 41.4773 95.3597 41.5085 95.6337 41.5892L117.787 48.1109C118.061 48.1915 118.315 48.32 118.533 48.4892C118.752 48.6583 118.931 48.8647 119.06 49.0965C119.19 49.3284 119.267 49.5812 119.288 49.8404C119.309 50.0997 119.273 50.3603 119.182 50.6074Z" fill="#FCDEE2"/>
            <path d="M106.069 82.133C105.816 82.1375 105.563 82.1033 105.322 82.0321L83.1693 75.5104C82.6023 75.3427 82.1333 74.9792 81.8651 74.4995C81.5969 74.0197 81.5514 73.463 81.7385 72.9512L92.8022 42.8419C92.9909 42.3306 93.3967 41.9066 93.9306 41.663C94.4646 41.4193 95.0831 41.3758 95.6506 41.5421L117.804 48.0638C118.371 48.2308 118.841 48.5942 119.109 49.0741C119.377 49.5541 119.423 50.1112 119.235 50.623L108.172 80.7322C108.025 81.1324 107.743 81.482 107.367 81.7329C106.99 81.9838 106.537 82.1236 106.069 82.133ZM94.9106 41.5441C94.4662 41.5523 94.035 41.6846 93.6766 41.9227C93.3181 42.1607 93.0501 42.4929 92.9097 42.8731L81.8457 72.982C81.6678 73.4682 81.7109 73.9972 81.9657 74.453C82.2205 74.9089 82.6661 75.2543 83.2048 75.4135L105.358 81.9352C105.625 82.0138 105.907 82.0442 106.187 82.0247C106.468 82.0052 106.741 81.9362 106.993 81.8215C107.244 81.7069 107.468 81.5488 107.652 81.3565C107.836 81.1641 107.976 80.9412 108.064 80.7005L119.128 50.5921L119.182 50.6078L119.128 50.5921C119.216 50.3514 119.252 50.0976 119.231 49.8451C119.211 49.5926 119.135 49.3464 119.009 49.1206C118.883 48.8948 118.708 48.6938 118.496 48.5291C118.283 48.3644 118.036 48.2392 117.769 48.1607L95.6159 41.639C95.3886 41.5719 95.1501 41.5398 94.9106 41.5441Z" fill="#390075"/>
            <g opacity="0.3">
              <path d="M118.913 50.5195L107.85 80.6288C107.759 80.8759 107.615 81.1047 107.426 81.3021C107.238 81.4995 107.008 81.6617 106.75 81.7794C106.492 81.8971 106.211 81.968 105.923 81.988C105.635 82.008 105.346 81.9768 105.072 81.896L82.9186 75.3744C82.5194 75.2571 82.1665 75.0389 81.9018 74.7458C81.6371 74.4528 81.4718 74.097 81.4254 73.7209C81.6903 74.0192 82.0464 74.241 82.45 74.3595L104.603 80.8812C104.877 80.9618 105.166 80.993 105.454 80.973C105.742 80.9529 106.023 80.8819 106.281 80.7642C106.539 80.6464 106.769 80.4841 106.958 80.2866C107.147 80.089 107.29 79.8601 107.381 79.6129L118.445 49.5046C118.545 49.2334 118.579 48.9458 118.543 48.6623C118.772 48.9186 118.926 49.2229 118.991 49.5473C119.056 49.8718 119.029 50.206 118.913 50.5195Z" fill="#B0B0B0"/>
            </g>
            <path d="M106.074 82.4149C105.786 82.4197 105.498 82.3806 105.224 82.2992L83.0706 75.7781C82.4245 75.5872 81.89 75.1729 81.5844 74.6262C81.2789 74.0795 81.2272 73.445 81.4407 72.8619L92.5044 42.7539C92.7187 42.1709 93.181 41.6874 93.7896 41.4097C94.3983 41.132 95.1034 41.0829 95.75 41.2732L117.903 47.7949C118.549 47.9859 119.084 48.4001 119.389 48.9468C119.695 49.4935 119.747 50.128 119.533 50.7111L108.47 80.8193C108.302 81.275 107.981 81.6732 107.552 81.959C107.123 82.2448 106.607 82.4041 106.074 82.4149ZM94.9118 41.8246C94.5327 41.8324 94.1651 41.9459 93.8597 42.1494C93.5543 42.3529 93.326 42.6365 93.2065 42.9609L82.1427 73.0689C81.9904 73.484 82.027 73.9359 82.2444 74.3254C82.4619 74.7148 82.8424 75.0099 83.3025 75.1459L105.456 81.6676C105.916 81.8032 106.418 81.7683 106.851 81.5707C107.285 81.3731 107.614 81.029 107.767 80.614L118.83 50.5058C118.982 50.0908 118.946 49.6391 118.728 49.2499C118.511 48.8607 118.13 48.5658 117.671 48.4297L95.5174 41.9061C95.3222 41.8485 95.1175 41.821 94.9118 41.8246Z" fill="white"/>
            <path d="M96.741 47.436L113.012 52.0255" stroke="#E6D1D4" stroke-linecap="round"/>
            <path d="M95.3347 52.0625L111.606 56.6519" stroke="#E6D1D4" stroke-linecap="round"/>
            <path d="M93.4648 56.269L109.736 60.8585" stroke="#E6D1D4" stroke-linecap="round"/>
            <path d="M91.5925 61.3164L107.864 65.9058" stroke="#E6D1D4" stroke-linecap="round"/>
            <path d="M85.9902 70.1544C86.7687 68.7518 89.0696 66.1132 92.0453 66.7794C94.0643 67.2315 94.1944 69.6481 93.777 71.8998C93.4546 73.6395 91.5403 74.9634 90.1589 73.866C89.4945 73.3382 89.2711 72.5475 90.1741 71.4066C91.4669 69.7733 93.5759 69.2545 95.2651 69.1821C96.466 69.1305 97.4627 69.936 97.5697 71.1326C97.5988 71.4578 97.6162 71.8242 97.6153 72.2317C97.6137 72.9322 98.0761 74.1641 99.9384 73.4878C101.801 72.8114 103.663 72.3593 104.128 72.2182" stroke="#929292" stroke-width="0.5" stroke-linecap="round"/>
            <g clip-path="url(#clip0_304_2672)">
              <path d="M128.044 60.875C128.177 60.8248 128.31 60.7755 128.441 60.7265C131.309 59.6567 133.594 58.8145 134.26 58.5693C134.287 58.5596 134.315 58.5549 134.345 58.5556C134.374 58.5563 134.402 58.5624 134.429 58.5735C134.486 58.5971 134.532 58.6384 134.558 58.69L134.932 59.3974C134.96 59.4468 134.967 59.5039 134.952 59.5569C134.936 59.61 134.899 59.6552 134.848 59.6834C134.22 60.0003 132.063 61.0876 129.348 62.4428C129.224 62.5047 129.098 62.5675 128.971 62.6305C123.475 65.3725 115.951 69.0828 114.047 69.8095C111.932 70.617 109.895 70.8053 108.821 70.8439C108.785 70.8453 108.75 70.8464 108.717 70.8476C108.715 70.8475 108.712 70.8475 108.71 70.8477C108.657 70.8489 108.608 70.8504 108.561 70.8509L108.409 70.9167L108.322 70.8529C108.273 70.8528 108.231 70.8506 108.193 70.852C108.091 70.8505 108.036 70.8477 108.036 70.8477L108.036 70.6443L107.861 70.5168C107.861 70.5168 107.92 70.442 108.035 70.3116L108.035 70.2093L108.187 70.1433C108.217 70.1107 108.249 70.075 108.284 70.0403C108.285 70.0387 108.287 70.0369 108.288 70.035C108.31 70.0122 108.333 69.988 108.357 69.9636C109.063 69.2291 110.502 67.9089 112.521 66.9199C114.338 66.0314 122.242 63.0404 128.044 60.875Z" fill="#3E4D84"/>
              <path d="M128.281 61.3245C128.415 61.2744 128.548 61.2251 128.679 61.1761C131.547 60.1063 133.831 59.2641 134.497 59.0189C134.524 59.0091 134.553 59.0045 134.582 59.0052C134.611 59.0059 134.64 59.012 134.667 59.0231C134.723 59.0467 134.769 59.088 134.796 59.1396L134.932 59.3977C134.961 59.4471 134.968 59.5041 134.952 59.5572C134.936 59.6103 134.899 59.6555 134.849 59.6837C134.221 60.0006 132.063 61.0879 129.348 62.4431C129.224 62.505 129.098 62.5678 128.972 62.6308C123.475 65.3728 115.951 69.0831 114.047 69.8098C111.932 70.6173 109.895 70.8056 108.821 70.8442C108.785 70.8456 108.75 70.8467 108.717 70.8479C108.715 70.8477 108.712 70.8478 108.71 70.848C108.658 70.8492 108.608 70.8507 108.561 70.8512L108.409 70.917L108.322 70.8532C108.273 70.8531 108.231 70.8509 108.194 70.8522C108.216 70.8258 108.243 70.7956 108.273 70.7612L108.273 70.6589L108.425 70.5929C108.456 70.5588 108.49 70.523 108.526 70.4845C108.548 70.4617 108.571 70.4376 108.594 70.4132C109.301 69.6787 110.739 68.3585 112.758 67.3695C114.576 66.481 122.48 63.49 128.281 61.3245Z" fill="#4D5B9C"/>
              <path d="M108.055 71.632C108.275 71.3081 108.715 70.8434 108.715 70.8434L108.291 70.0416C108.291 70.0416 107.616 70.0611 107.2 70.0135C106.784 69.9659 106.416 69.9197 105.817 70.5C105.217 71.0802 104.07 72.1952 104.07 72.1952L103.711 72.3508L103.77 72.4624L106.075 71.3918C106.064 71.333 106.074 71.2729 106.102 71.2202C106.131 71.1675 106.177 71.1249 106.234 71.0986C106.291 71.0722 106.356 71.0635 106.42 71.0737C106.484 71.0838 106.543 71.1123 106.589 71.1551C106.589 71.1551 106.699 71.2445 106.691 71.3486C106.699 71.4078 106.686 71.4673 106.655 71.5187C106.624 71.5701 106.576 71.6106 106.517 71.6345C106.459 71.6584 106.393 71.6643 106.33 71.6514C106.267 71.6386 106.209 71.6076 106.166 71.563L103.801 72.521L103.86 72.6323L104.218 72.4767C104.218 72.4767 105.898 72.3637 106.77 72.3046C107.643 72.2455 107.834 71.9567 108.055 71.632Z" fill="#929292"/>
              <path d="M128.044 60.8753C128.177 60.8251 128.31 60.7758 128.441 60.7268L129.349 62.4441C129.224 62.506 129.099 62.5689 128.972 62.6318L128.044 60.8753Z" fill="#E1E1E1"/>
              <path d="M124.19 61.4548C124.178 61.4498 124.183 61.4665 124.182 61.4745C124.184 61.4851 124.187 61.4956 124.19 61.5059C124.198 61.5282 124.208 61.5496 124.221 61.5696C124.247 61.6113 124.282 61.6482 124.323 61.6783C124.412 61.7418 124.519 61.7784 124.63 61.7832L124.719 61.7828L124.807 61.7724C124.82 61.7713 124.834 61.7685 124.847 61.7641C124.858 61.759 124.871 61.7587 124.886 61.7534C124.913 61.7416 124.941 61.7341 124.969 61.723C125.082 61.6784 125.198 61.6236 125.311 61.5675C125.764 61.338 126.208 61.082 126.65 60.8237C127.532 60.306 128.404 59.7652 129.317 59.2775C129.772 59.0318 130.239 58.8 130.726 58.5936C130.968 58.4884 131.217 58.3939 131.474 58.307C131.605 58.267 131.737 58.2297 131.868 58.1912C131.933 58.1708 132.002 58.1593 132.07 58.1447L132.274 58.1009C132.342 58.0874 132.413 58.0791 132.483 58.0695C132.553 58.06 132.623 58.0504 132.692 58.0442C132.762 58.038 132.836 58.0354 132.91 58.0331C132.946 58.0321 132.981 58.0288 133.017 58.0301L133.127 58.0346C133.427 58.0387 133.724 58.101 133.998 58.2175C134.274 58.3362 134.509 58.5237 134.676 58.7583C134.755 58.8696 134.818 58.9894 134.865 59.1148C134.888 59.1757 134.906 59.2385 134.923 59.2999C134.941 59.3613 134.949 59.4247 134.959 59.4865C134.96 59.4897 134.959 59.493 134.959 59.4961C134.958 59.4992 134.956 59.5021 134.954 59.5047C134.952 59.5072 134.95 59.5093 134.947 59.511C134.944 59.5126 134.94 59.5136 134.937 59.514C134.932 59.5146 134.927 59.5138 134.922 59.5117C134.918 59.5097 134.914 59.5065 134.911 59.5025L134.91 59.5004C134.874 59.4475 134.843 59.3936 134.807 59.3421C134.771 59.2906 134.736 59.24 134.696 59.1929C134.622 59.0998 134.537 59.0134 134.445 58.935C134.272 58.788 134.063 58.6824 133.836 58.6277C133.611 58.5742 133.377 58.5587 133.148 58.5819L133.061 58.5867C133.032 58.5889 133.002 58.5953 132.972 58.5994C132.913 58.6091 132.854 58.616 132.794 58.6244C132.735 58.6327 132.674 58.65 132.616 58.6602C132.558 58.6703 132.497 58.6831 132.438 58.6988C131.955 58.8262 131.483 58.9883 131.028 59.1834C130.561 59.3765 130.097 59.5881 129.629 59.7965C128.697 60.2222 127.765 60.6568 126.837 61.1113C126.373 61.337 125.915 61.5698 125.441 61.7899C125.322 61.8442 125.204 61.8993 125.076 61.9487C125.044 61.9605 125.009 61.9712 124.975 61.9825C124.938 61.9934 124.9 62.0019 124.861 62.0079C124.825 62.0131 124.789 62.0184 124.753 62.0225L124.641 62.0293C124.485 62.0363 124.329 62.0175 124.179 61.9738C124.098 61.9514 124.02 61.9212 123.946 61.8837C123.926 61.8747 123.907 61.8647 123.888 61.8539C123.868 61.8442 123.849 61.833 123.83 61.8213C123.811 61.8097 123.792 61.7963 123.772 61.7835C123.747 61.7677 123.725 61.7495 123.705 61.7293C123.684 61.6991 123.669 61.6655 123.663 61.6305C123.656 61.5954 123.656 61.5596 123.665 61.5251C123.673 61.4906 123.688 61.4581 123.71 61.4295C123.733 61.4009 123.761 61.3767 123.793 61.3585C123.826 61.3402 123.862 61.3282 123.9 61.3231C123.938 61.318 123.977 61.3199 124.014 61.3288C124.052 61.3376 124.087 61.3532 124.118 61.3746C124.149 61.3961 124.176 61.4229 124.196 61.4536L124.19 61.4548Z" fill="#929292"/>
              <path d="M110.222 70.3516C110.222 70.3516 113.076 70.0156 115.782 68.5549C115.782 68.5549 116.04 68.2284 114.685 68.75C113.33 69.2716 109.635 70.1696 110.222 70.3516Z" fill="#6677B5"/>
              <path d="M108.357 69.9652L108.821 70.8448C108.786 70.8462 108.751 70.8473 108.717 70.8485L108.288 70.0365C108.31 70.0137 108.333 69.9896 108.357 69.9652Z" fill="#3B4167"/>
            </g>
            <defs>
              <clipPath id="clip0_304_2672">
                <rect width="3.8939" height="33.8301" fill="white" transform="matrix(-0.467095 -0.883973 0.917378 -0.398473 104.555 73.9482)"/>
              </clipPath>
            </defs>
          </svg>
        </div>
      </div>
    </div>
  </app-modal>
</template>

<script>
import AppModal from '@/components/app-modal/'
import AppForm from '@/components/app-form/'
import SignatureProxy from '@/store/proxies/signature-proxy'
import FileProxy from '@/store/proxies/file-proxy'
import CaSignProxy from '@/store/proxies/ca-sign-proxy'
import { mapActions } from 'vuex'

export default {
  name: 'UserProfileModal',
  components: {
    AppModal,
    AppForm
  },
  data () {
    return {
      company: 'FPT',
      title: this.$t('user.updateUserInfo'),
      imageSignatureModel: null,
      imageSignatureUrl: null,
      digitalSignatureModel: null,
      formModelUser: {
        name: null,
        phone: null,
        password: null
      },
      formModelCompany: {
        name: null,
        full_name: null,
        tax_code: null,
        company_address: null
      },
      layoutUser: {
        'div.row': {
          'div.col-md-6': {
            field: 'name'
          },
          'div.col-md-6:2': {
            field: 'phone'
          },
          'div.col-md-6:4': {
            field: 'password'
          },
          'div.col-md-6:5': {
            field: 're-password'
          }
        }
      },
      layoutCompany: {
        'div.row': {
          'div.col-md-6': {
            field: 'name'
          },
          'div.col-md-6:2': {
            field: 'tax_code'
          },
          'div.col-md-12:4': {
            field: 'full_name'
          },
          'div.col-md-12:5': {
            field: 'company_address'
          }
        }
      },
      schemaCompany: [
        {
          name: 'name',
          label: this.$t('user.name'),
          placeholder: `${this.$t('app.enter')} ${this.$t('user.name')}`,
          type: 'input',
          validation: 'required'
        },
        {
          name: 'full_name',
          label: this.$t('user.companyFullName'),
          placeholder: `${this.$t('app.enter')} ${this.$t('user.companyFullName')}`,
          type: 'input',
          validation: 'required'
        },
        {
          name: 'tax_code',
          label: this.$t('user.taxCode'),
          placeholder: `${this.$t('app.enter')} ${this.$t('user.taxCode')}`,
          inputType: 'number',
          type: 'input',
          readonly: true,
          validation: 'required'
        },
        {
          name: 'company_address',
          label: this.$t('user.companyAddress'),
          placeholder: `${this.$t('app.enter')} ${this.$t('user.companyAddress')}`,
          type: 'input',
          validation: 'required'
        }
      ],
      schemaUser: [
        {
          name: 'name',
          label: this.$t('user.name'),
          placeholder: `${this.$t('app.enter')} ${this.$t('user.name')}`,
          type: 'input',
          validation: 'required'
        },
        {
          name: 'phone',
          label: this.$t('user.phone'),
          placeholder: `${this.$t('app.enter')} ${this.$t('user.phone')}`,
          type: 'input',
          validation: 'required'
        },
        {
          name: 'password',
          label: this.$t('user.password'),
          placeholder: this.$t('user.updateNewPassword'),
          inputType: 'password',
          type: 'input',
          validation: 'min:6'
        },
        {
          name: 're-password',
          label: this.$t('user.repassword'),
          placeholder: this.$t('user.repassword'),
          inputType: 'password',
          type: 'input',
          asyncValidation: (value, resolve, formData) => {
            let result = true
            if (formData.password && formData.password !== value) {
              result = { msg: this.$t('user.repasswordDoesNotMatch') }
            }
            resolve(result)
          }
        }
      ],
      street: 'D1',
      city: 'HCM'
    }
  },
  computed: {
    address () {
      return `${this.street}  - ${this.city}`
    }
  },
  beforeDestroy () {

  },
  created () {
    // Cal api server
  },
  methods: {
    ...mapActions('auth', ['updateUserProfile', 'updateCompanyInfo']),
    onSubmitUserForm (formModel, validateFunc, { resolve }) {
      this.$refs.formUser.validate().then((isValid) => {
        if (isValid) {
          this.updateUserProfile(formModel).then(() => {
            resolve()
          })
        }
      })
    },
    onSubmitCompanyForm (formModel, validateFunc, { resolve }) {
      this.$refs.formCompany.validate().then((isValid) => {
        if (isValid) {
          if (!formModel.name) {
            formModel.name = formModel.full_name
          }
          this.updateCompanyInfo(formModel).then(() => {
            resolve()
          })
        }
      })
    },
    onSelectImageSignature (model) {
      new SignatureProxy().createSignature(model, {
        uploading: false,
        percentCompleted: 0
      }).then(() => {
        this.loadCurrentSignature()
      })
    },
    onSelectDigitalSignature () {
      this.loadCurrentDigitalSignature()
    },
    onOk () {
      this.$refs.formUser.submit()
        .then(() => this.$refs.formCompany.submit())
        .then(() => {
          this.$modal.hide('user-profile-modal', { isOk: true })
        })
    },
    beforeOpen () {
      this.$bus.on('close-image-signature-modal', this.onSelectImageSignature)
      this.$bus.on('close-digital-signature-modal', this.onSelectDigitalSignature)
      const currentUser = JSON.parse(localStorage.getItem('currentUser'))
      this.formModelUser.name = currentUser.name
      this.formModelUser.phone = currentUser.phone
      this.formModelCompany = {
        ...currentUser.company
      }
      this.loadCurrentSignature()
      this.loadCurrentDigitalSignature()
    },
    beforeClose () {
      this.$bus.off('close-image-signature-modal', this.onSelectImageSignature)
      this.$bus.off('close-digital-signature-modal', this.onSelectDigitalSignature)
    },
    openModal (modalName) {
      this.$modal.show(modalName, { model: {} })
    },
    deleteDigitalSignature (digitalSignatureModel) {
      new CaSignProxy().deleteSignature(digitalSignatureModel.id).then(() => {
        this.digitalSignatureModel = null
      })
    },
    deleteImageSignature (signatureModel) {
      new SignatureProxy().deleteSignature(signatureModel.id).then(() => {
        this.imageSignatureModel = null
        this.imageSignatureUrl = null
      })
    },
    loadCurrentSignature () {
      new SignatureProxy({ limit: 1, page: 1 }).getSignature().then((res) => {
        if (res && res.length > 0) {
          this.imageSignatureModel = res[0]
          const fileId = this.imageSignatureModel.file_id
          new FileProxy().getFile(fileId).then((file) => {
            const urlCreator = window.URL || window.webkitURL
            this.imageSignatureUrl = urlCreator.createObjectURL(file)
          })
        }
      })
    },
    loadCurrentDigitalSignature () {
      new CaSignProxy().getActiveCertificate().then((res) => {
        if (res && res.length > 0) {
          this.digitalSignatureModel = res[0]
        } else {
          this.digitalSignatureModel = null
        }
      })
    }

  }
}
</script>
<style>
 .signature-place-holder {
   background: rgb(230, 236, 244);
 }
 .section-header {
   font-size: .875rem;
   color: #38424B;
   background: #E6ECF4;
   padding: .5rem 1.5rem;
   margin-bottom: 1rem;
   margin-left: -1rem;
   margin-right: -1rem;
 }
</style>
